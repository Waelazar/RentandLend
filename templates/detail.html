{% extends "layout.html" %}

{% block title %}
    Product Details
{% endblock %}

{% block main %}
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <p class="lead">Rent&Lend</p>
            <div class="list-group">
                <li class="list-group-item active">Info 1</li>
                <li class="list-group-item">Info 2</li>
                <li class="list-group-item">Info 3</li>
            </div>
        </div>
        <div class="col-md-9">
            <div class="thumbnail">
                <img class="img-fluid" src="{{ image_paths[0]["path"]}}">
                <hr>
                <div class="caption-full">
                    <h4 class="text-right">Price {{ usd(product["price"]) }}</h4>
                    <h4 class="text-left"><a>{{ product["name"] }}</a></h4>
                    <p class="text-left paragraph1">{{ product["description"] }}</p>
                    <p class="text-left">
                        <em>Submitted By {{ product["username"] }}</em>
                    </p>
                    {% if product_owner %}
                        <a class="text-left btn btn-xs btn-outline-warning" href="/edit_product?product_id={{product["product_id"]}}">Edit</a>
                    {% endif %}
                </div>
            </div>
            <br>
            <div class="card">
                <div class="row" id="messages">
                 {% for msg in messages %}
                    <div class="col-md-6">
                    <p class="text-left paragraph"><strong>{{ msg.username }}</strong></p>
                    </div>
                    <div class="col-md-6">
                    <p class="text-right date">{{ msg.time }}</p>
                    </div>
                    <div class="col-md-12">
                    <p class="text-left paragraph">
                        {{msg.text}}
                    </p>
                    <hr>
                </div>
                {% endfor %}
                </div>
                <div class="row">
                    <div class="col-md-10 text-left">
                        <textarea autofocus type="text" id="myMessage" rows="3" cols="90"></textarea>
                    </div>
                    <div class="col-md-2 text-center">
                       <button type="button" class="btn btn-outline-success" id="sendbutton">Send</button>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
        var socket = io.connect('http://ide50-waelazar1.cs50.io:8080');
        socket.on('message', function(msg) {
            $("#messages").append('<hr><div class="col-md-6 text-left">\
                            <p class="paragraph"><strong>' + msg.username + '</strong></p>\
                            </div>\
                            <div class="col-md-6 text-right">\
                            <p class="date">'+msg.time+ '</p>\
                            </div>\
                            <div class="col-md-12 text-left">\
                            <p class=" paragraph">\
                                '+ msg.message+
                            '</p>\
                            </div>\
                        <hr>');
            console.log('Received message');
        });
        $('#sendbutton').on('click', function() {
            socket.send({message:$('#myMessage').val(), user_id:{{ user_id }}, product_id:{{product.product_id}}});
            $('#myMessage').val('');
        });
    });
    </script>

{% endblock %}